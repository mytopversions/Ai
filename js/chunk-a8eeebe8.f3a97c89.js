(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a8eeebe8"],{"4dd7":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wallet-page"},[a("div",{staticClass:"container pb-tabs"},[a("div",{staticClass:"header-actions"},[a("h2",[t._v("钱包管理")]),a("div",{staticClass:"wallet-actions"},[a("button",{staticClass:"btn btn-primary",on:{click:t.openCreateDialog}},[t._v("创建")]),a("button",{staticClass:"btn btn-secondary ml-1",on:{click:function(e){t.showImportDialog=!0}}},[t._v("导入")]),a("button",{staticClass:"btn btn-secondary ml-1",on:{click:function(e){t.showWatchWalletDialog=!0}}},[t._v("添加观察钱包")])])]),t.loading?a("div",{staticClass:"loading-spinner"},[t._v(" 加载中... ")]):0===t.wallets.length?a("div",{staticClass:"empty-state"},[a("p",[t._v("暂无钱包，请创建或导入钱包")])]):a("div",{staticClass:"wallet-list"},t._l(t.wallets,(function(e){return a("div",{key:e.address,staticClass:"card wallet-card"},[a("div",{staticClass:"wallet-header"},[a("div",{staticClass:"wallet-address"},[e.remark?a("span",{staticClass:"wallet-remark"},[t._v("【"+t._s(e.remark)+"】")]):t._e(),e.isWatchOnly?a("span",{staticClass:"watch-only-tag"},[t._v("【观察】")]):t._e(),t._v(" "+t._s(t.formatAddress(e.address))+" ")]),a("div",{staticClass:"wallet-balance"},[t._v(t._s(t.formatBalance(e.balance))+" TRX")])]),a("div",{staticClass:"wallet-info"},[a("div",{staticClass:"info-item"},[a("div",{staticClass:"info-label"},[t._v("绑定转出地址")]),a("div",{staticClass:"info-value"},[t._v(t._s(e.isWatchOnly?"-":t.formatAddress(e.bindAddress)))])]),a("div",{staticClass:"info-item"},[a("div",{staticClass:"info-label"},[t._v("备注")]),a("div",{staticClass:"info-value"},[a("div",{staticClass:"edit-remark"},[a("span",[t._v(t._s(e.remark||"-"))]),a("button",{staticClass:"btn-icon",on:{click:function(a){return t.openEditRemarkDialog(e)}}},[a("i",{staticClass:"icon-edit"},[t._v("✎")])])])])])]),a("div",{staticClass:"wallet-actions single-action"},[a("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:e.isWatchOnly||t.transferLoading===e.address||e.balance<=0},on:{click:function(a){return a.stopPropagation(),a.preventDefault(),t.openTransferDialog(e)}}},[t._v(" 转出 "),t.transferLoading===e.address?a("span",[t._v("(处理中...)")]):t._e(),e.isWatchOnly?a("span",[t._v("(观察钱包)")]):t._e()])])])})),0)]),t.showCreateDialog?a("div",{staticClass:"dialog-overlay",on:{click:t.hideDialogs}},[a("div",{staticClass:"dialog-content",on:{click:function(t){t.stopPropagation()}}},[a("h3",{staticClass:"dialog-title"},[t._v("创建钱包")]),a("div",{staticClass:"form-group"},[a("label",[t._v("私钥（自动生成）")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.newWallet.privateKey,expression:"newWallet.privateKey"}],attrs:{type:"text",readonly:""},domProps:{value:t.newWallet.privateKey},on:{input:function(e){e.target.composing||t.$set(t.newWallet,"privateKey",e.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",[t._v("地址（自动生成）")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.newWallet.address,expression:"newWallet.address"}],attrs:{type:"text",readonly:""},domProps:{value:t.newWallet.address},on:{input:function(e){e.target.composing||t.$set(t.newWallet,"address",e.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",[t._v("绑定转出地址")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.newWallet.bindAddress,expression:"newWallet.bindAddress"}],attrs:{type:"text",placeholder:"请输入转出地址"},domProps:{value:t.newWallet.bindAddress},on:{input:function(e){e.target.composing||t.$set(t.newWallet,"bindAddress",e.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",[t._v("备注（选填）")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.newWallet.remark,expression:"newWallet.remark"}],attrs:{type:"text",placeholder:"请输入钱包备注"},domProps:{value:t.newWallet.remark},on:{input:function(e){e.target.composing||t.$set(t.newWallet,"remark",e.target.value)}}})]),a("div",{staticClass:"dialog-actions"},[a("button",{staticClass:"btn btn-secondary",on:{click:t.hideDialogs}},[t._v("取消")]),a("button",{staticClass:"btn btn-primary",attrs:{disabled:t.createLoading},on:{click:t.handleCreateWallet}},[t._v("确认")])])])]):t._e(),t.showImportDialog?a("div",{staticClass:"dialog-overlay",on:{click:t.hideDialogs}},[a("div",{staticClass:"dialog-content",on:{click:function(t){t.stopPropagation()}}},[a("h3",{staticClass:"dialog-title"},[t._v("导入钱包")]),a("div",{staticClass:"form-group"},[a("label",[t._v("私钥")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.importedWallet.privateKey,expression:"importedWallet.privateKey"}],attrs:{type:"text",placeholder:"请输入私钥"},domProps:{value:t.importedWallet.privateKey},on:{input:function(e){e.target.composing||t.$set(t.importedWallet,"privateKey",e.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",[t._v("地址（自动识别）")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.importedWallet.address,expression:"importedWallet.address"}],attrs:{type:"text",readonly:""},domProps:{value:t.importedWallet.address},on:{input:function(e){e.target.composing||t.$set(t.importedWallet,"address",e.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",[t._v("绑定转出地址")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.importedWallet.bindAddress,expression:"importedWallet.bindAddress"}],attrs:{type:"text",placeholder:"请输入转出地址"},domProps:{value:t.importedWallet.bindAddress},on:{input:function(e){e.target.composing||t.$set(t.importedWallet,"bindAddress",e.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",[t._v("备注（选填）")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.importedWallet.remark,expression:"importedWallet.remark"}],attrs:{type:"text",placeholder:"请输入钱包备注"},domProps:{value:t.importedWallet.remark},on:{input:function(e){e.target.composing||t.$set(t.importedWallet,"remark",e.target.value)}}})]),a("div",{staticClass:"dialog-actions"},[a("button",{staticClass:"btn btn-secondary",on:{click:t.hideDialogs}},[t._v("取消")]),a("button",{staticClass:"btn btn-primary",attrs:{disabled:t.importLoading},on:{click:t.handleImportWallet}},[t._v("确认")])])])]):t._e(),t.showTransferDialogFlag?a("div",{staticClass:"dialog-overlay",on:{click:t.hideDialogs}},[a("div",{staticClass:"dialog-content",on:{click:function(t){t.stopPropagation()}}},[a("h3",{staticClass:"dialog-title"},[t._v("转出")]),a("div",{staticClass:"form-group"},[a("label",[t._v("当前余额")]),a("input",{attrs:{type:"text",readonly:""},domProps:{value:t.currentWallet?t.formatBalance(t.currentWallet.balance)+" TRX":"0 TRX"}})]),a("div",{staticClass:"form-group"},[a("label",[t._v("转出地址")]),a("input",{attrs:{type:"text",readonly:""},domProps:{value:t.currentWallet?t.currentWallet.bindAddress:""}})]),a("div",{staticClass:"form-group"},[a("label",[t._v("转出金额")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.transferAmount,expression:"transferAmount"}],attrs:{type:"number",placeholder:"请输入转出金额"},domProps:{value:t.transferAmount},on:{input:function(e){e.target.composing||(t.transferAmount=e.target.value)}}})]),a("div",{staticClass:"dialog-actions"},[a("button",{staticClass:"btn btn-secondary",on:{click:t.hideDialogs}},[t._v("取消")]),a("button",{staticClass:"btn btn-primary",attrs:{disabled:t.transferLoading||!t.transferAmount||parseFloat(t.transferAmount)<=0||parseFloat(t.transferAmount)>(t.currentWallet?t.currentWallet.balance:0)},on:{click:t.transferOut}},[t._v(" 确认 ")])])])]):t._e(),t.showEditRemarkDialog?a("div",{staticClass:"dialog-overlay",on:{click:t.hideDialogs}},[a("div",{staticClass:"dialog-content",on:{click:function(t){t.stopPropagation()}}},[a("h3",{staticClass:"dialog-title"},[t._v("修改备注")]),a("div",{staticClass:"form-group"},[a("label",[t._v("钱包地址")]),a("input",{attrs:{type:"text",readonly:""},domProps:{value:t.currentWallet?t.formatAddress(t.currentWallet.address):""}})]),a("div",{staticClass:"form-group"},[a("label",[t._v("备注")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.remarkText,expression:"remarkText"}],attrs:{type:"text",placeholder:"请输入备注"},domProps:{value:t.remarkText},on:{input:function(e){e.target.composing||(t.remarkText=e.target.value)}}})]),a("div",{staticClass:"dialog-actions"},[a("button",{staticClass:"btn btn-secondary",on:{click:t.hideDialogs}},[t._v("取消")]),a("button",{staticClass:"btn btn-primary",attrs:{disabled:t.remarkLoading},on:{click:t.updateRemark}},[t._v(" 确认 ")])])])]):t._e(),t.showWatchWalletDialog?a("div",{staticClass:"dialog-overlay",on:{click:t.hideDialogs}},[a("div",{staticClass:"dialog-content",on:{click:function(t){t.stopPropagation()}}},[a("h3",{staticClass:"dialog-title"},[t._v("添加观察钱包")]),a("div",{staticClass:"form-group"},[a("label",[t._v("钱包地址")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.watchWallet.address,expression:"watchWallet.address"}],attrs:{type:"text",placeholder:"请输入钱包地址"},domProps:{value:t.watchWallet.address},on:{input:function(e){e.target.composing||t.$set(t.watchWallet,"address",e.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",[t._v("备注（选填）")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.watchWallet.remark,expression:"watchWallet.remark"}],attrs:{type:"text",placeholder:"请输入钱包备注"},domProps:{value:t.watchWallet.remark},on:{input:function(e){e.target.composing||t.$set(t.watchWallet,"remark",e.target.value)}}})]),a("div",{staticClass:"dialog-actions"},[a("button",{staticClass:"btn btn-secondary",on:{click:t.hideDialogs}},[t._v("取消")]),a("button",{staticClass:"btn btn-primary",attrs:{disabled:t.watchWalletLoading},on:{click:t.handleImportWatchWallet}},[t._v(" 确认 ")])])])]):t._e()])},l=[],r=a("2f62"),i=a("d01b"),o=a.n(i),n=a("f121"),d={name:"Wallet",data(){return{loading:!0,showCreateDialog:!1,showImportDialog:!1,showTransferDialogFlag:!1,showEditRemarkDialog:!1,showWatchWalletDialog:!1,createLoading:!1,importLoading:!1,transferLoading:null,remarkLoading:!1,watchWalletLoading:!1,newWallet:{privateKey:"",address:"",bindAddress:"",remark:""},importedWallet:{privateKey:"",address:"",bindAddress:"",remark:""},watchWallet:{address:"",remark:""},currentWallet:null,transferAmount:"",remarkText:"",config:{API_CONFIG:n["a"],TIME_CONFIG:n["d"]}}},computed:{...Object(r["e"])(["wallets","isUnlocked"])},watch:{"importedWallet.privateKey":function(t){if(t)try{const e=new o.a({fullHost:n["a"].TRON_API_BASE}),a=e.address.fromPrivateKey(t);this.importedWallet.address=a}catch(e){console.error("处理私钥出错:",e),this.importedWallet.address="无效的私钥"}else this.importedWallet.address=""}},created(){this.isUnlocked?(this.fetchData(),0===this.wallets.length&&this.generateNewWallet().then(()=>{this.showCreateDialog=!0}).catch(t=>{console.error("首次使用生成钱包失败:",t)})):this.$router.push("/login")},methods:{...Object(r["b"])(["updateAllWallets","createWallet","importWallet","importWatchWallet","transfer","updateWalletRemark"]),async fetchData(){this.loading=!0,await this.updateAllWallets(),this.loading=!1},generateNewWallet(){return new Promise((t,e)=>{try{console.log("开始生成钱包..."),console.log("TronWeb类型:",typeof o.a);const a=new o.a({fullHost:n["a"].TRON_API_BASE});console.log("TronWeb 实例化成功"),a.createAccount().then(e=>{console.log("生成账户成功:",e),this.newWallet.privateKey=e.privateKey,this.newWallet.address=e.address.base58,console.log("生成私钥成功:",this.newWallet.privateKey.substring(0,8)+"..."),t(e)}).catch(t=>{console.error("生成账户失败:",t),alert("生成私钥失败，请检查控制台错误信息"),e(t)})}catch(a){console.error("生成钱包失败",a),console.error("错误详情:",a.toString()),alert("生成私钥失败，请检查控制台错误信息"),e(a)}})},async openCreateDialog(){try{await this.generateNewWallet(),this.showCreateDialog=!0}catch(t){console.error("打开创建钱包对话框失败:",t)}},async handleCreateWallet(){if(!this.newWallet.privateKey||!this.newWallet.address)return alert("私钥和地址未生成，请重试"),void this.hideDialogs();if(this.newWallet.bindAddress){this.createLoading=!0;try{console.log("创建钱包中，使用以下信息:"),console.log("- 地址:",this.newWallet.address.substring(0,8)+"..."),console.log("- 私钥长度:",this.newWallet.privateKey?this.newWallet.privateKey.length:0);await this.createWallet({privateKey:this.newWallet.privateKey,address:this.newWallet.address,bindAddress:this.newWallet.bindAddress,remark:this.newWallet.remark});alert("钱包创建成功"),this.hideDialogs(),this.fetchData()}catch(t){console.error("创建钱包详细错误:",t),alert("创建钱包失败: "+t.message)}finally{this.createLoading=!1}}else alert("请输入绑定的转出地址")},async handleImportWallet(){if(this.importedWallet.privateKey)if(this.importedWallet.bindAddress){this.importLoading=!0;try{const t=await this.importWallet({privateKey:this.importedWallet.privateKey,bindAddress:this.importedWallet.bindAddress,remark:this.importedWallet.remark});t.success?(alert("钱包导入成功"),this.hideDialogs(),setTimeout(()=>{this.fetchData()},this.config.TIME_CONFIG.REFRESH_DELAY)):alert("导入钱包失败: "+t.message)}catch(t){alert("导入钱包出错: "+t.message)}finally{this.importLoading=!1}}else alert("请输入绑定的转出地址");else alert("请输入私钥")},openTransferDialog(t){this.currentWallet=t,this.transferAmount="",this.showTransferDialogFlag=!0},async transferOut(){if(console.log("开始转出操作"),this.currentWallet){if(!this.transferAmount||parseFloat(this.transferAmount)<=0)return console.log("转出金额无效:",this.transferAmount),void alert("请输入有效的转出金额");if(parseFloat(this.transferAmount)>this.currentWallet.balance)return console.log("转出金额超过余额:",{"转出金额":parseFloat(this.transferAmount),"余额":this.currentWallet.balance}),void alert("转出金额不能大于当前余额");this.transferLoading=this.currentWallet.address;try{console.log("调用转账action:",{fromAddress:this.currentWallet.address,toAddress:this.currentWallet.bindAddress,amount:parseFloat(this.transferAmount)});const t=await this.transfer({fromAddress:this.currentWallet.address,toAddress:this.currentWallet.bindAddress,amount:parseFloat(this.transferAmount)});console.log("转账action返回结果:",t),t.success?(alert("转出交易发送成功，交易ID: "+t.txId),this.hideDialogs(),setTimeout(()=>{this.fetchData()},this.config.TIME_CONFIG.REFRESH_DELAY)):alert("转出失败: "+t.message)}catch(t){console.error("转出操作捕获到错误:",t),alert("转出操作出错: "+t.message)}finally{this.transferLoading=null}}else console.error("当前钱包不存在")},openEditRemarkDialog(t){this.currentWallet=t,this.remarkText=t.remark||"",this.showEditRemarkDialog=!0},async updateRemark(){if(this.currentWallet){this.remarkLoading=!0;try{const t=await this.updateWalletRemark({address:this.currentWallet.address,remark:this.remarkText});t.success?(alert("备注更新成功"),this.hideDialogs(),this.fetchData()):alert("更新备注失败: "+t.message)}catch(t){alert("更新备注出错: "+t.message)}finally{this.remarkLoading=!1}}},hideDialogs(){this.showCreateDialog=!1,this.showImportDialog=!1,this.showTransferDialogFlag=!1,this.showEditRemarkDialog=!1,this.showWatchWalletDialog=!1,this.currentWallet=null},formatAddress(t){return t?t.substring(0,8)+"..."+t.substring(t.length-8):""},formatBalance(t){return void 0===t||null===t?"0":parseFloat(t).toFixed(2)},async handleImportWatchWallet(){if(this.watchWallet.address){this.watchWalletLoading=!0;try{const t=await this.importWatchWallet({address:this.watchWallet.address,remark:this.watchWallet.remark});t.success?(alert("观察钱包添加成功"),this.hideDialogs(),setTimeout(()=>{this.fetchData()},this.config.TIME_CONFIG.REFRESH_DELAY)):alert("添加观察钱包失败: "+t.message)}catch(t){alert("添加观察钱包出错: "+t.message)}finally{this.watchWalletLoading=!1}}else alert("请输入钱包地址")}}},c=d,m=(a("7bad"),a("2877")),p=Object(m["a"])(c,s,l,!1,null,"6383e908",null);e["default"]=p.exports},"53a5":function(t,e,a){},"7bad":function(t,e,a){"use strict";a("53a5")}}]);