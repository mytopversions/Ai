(function(e){function t(t){for(var n,a,i=t[0],c=t[1],l=t[2],d=0,u=[];d<i.length;d++)a=i[d],Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&u.push(s[a][0]),s[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);p&&p(t);while(u.length)u.shift()();return o.push.apply(o,l||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],n=!0,a=1;a<r.length;a++){var i=r[a];0!==s[i]&&(n=!1)}n&&(o.splice(t--,1),e=c(c.s=r[0]))}return e}var n={},a={app:0},s={app:0},o=[];function i(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-3f53d80d":"ad35f670","chunk-4cd54a56":"db15cda8","chunk-a8eeebe8":"f3a97c89"}[e]+".js"}function c(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.e=function(e){var t=[],r={"chunk-3f53d80d":1,"chunk-4cd54a56":1,"chunk-a8eeebe8":1};a[e]?t.push(a[e]):0!==a[e]&&r[e]&&t.push(a[e]=new Promise((function(t,r){for(var n="css/"+({}[e]||e)+"."+{"chunk-3f53d80d":"178c9876","chunk-4cd54a56":"e45190b2","chunk-a8eeebe8":"2103e149"}[e]+".css",s=c.p+n,o=document.getElementsByTagName("link"),i=0;i<o.length;i++){var l=o[i],d=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(d===n||d===s))return t()}var u=document.getElementsByTagName("style");for(i=0;i<u.length;i++){l=u[i],d=l.getAttribute("data-href");if(d===n||d===s)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var n=t&&t.target&&t.target.src||s,o=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=n,delete a[e],p.parentNode.removeChild(p),r(o)},p.href=s;var f=document.getElementsByTagName("head")[0];f.appendChild(p)})).then((function(){a[e]=0})));var n=s[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise((function(t,r){n=s[e]=[t,r]}));t.push(n[2]=o);var l,d=document.createElement("script");d.charset="utf-8",d.timeout=120,c.nc&&d.setAttribute("nonce",c.nc),d.src=i(e);var u=new Error;l=function(t){d.onerror=d.onload=null,clearTimeout(p);var r=s[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+n+": "+a+")",u.name="ChunkLoadError",u.type=n,u.request=a,r[1](u)}s[e]=void 0}};var p=setTimeout((function(){l({type:"timeout",target:d})}),12e4);d.onerror=d.onload=l,document.head.appendChild(d)}return Promise.all(t)},c.m=e,c.c=n,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(r,n,function(t){return e[t]}.bind(null,n));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="",c.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],d=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var p=d;o.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},1:function(e,t){},10:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,r){"use strict";r.r(t);var n=r("a026"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[e.showTabs?r("div",{staticClass:"tab-bar"},[r("div",{staticClass:"tab-item",class:{active:"operation"===e.currentTab},on:{click:function(t){return e.switchTab("operation")}}},[e._v(" 操作 ")]),r("div",{staticClass:"tab-item",class:{active:"wallet"===e.currentTab},on:{click:function(t){return e.switchTab("wallet")}}},[e._v(" 钱包 ")])]):e._e(),r("router-view")],1)},s=[],o=r("2f62"),i={name:"App",computed:{...Object(o["e"])(["currentTab","isUnlocked"]),showTabs(){const e="/login"===this.$route.path;return console.log("Route:",this.$route.path,"isUnlocked:",this.isUnlocked,"Show tabs:",this.isUnlocked&&!e),this.isUnlocked&&!e}},created(){this.checkAuthStatus()},watch:{$route(e,t){this.checkAuthStatus()},isUnlocked(e,t){e||"/login"===this.$route.path||this.$router.push("/login")}},methods:{...Object(o["d"])(["SET_CURRENT_TAB"]),switchTab(e){console.log("切换到标签页:",e),this.SET_CURRENT_TAB(e);const t="/"+e;this.$route.path!==t&&this.$router.push(t).catch(e=>{"NavigationDuplicated"!==e.name&&console.error("导航错误:",e)})},checkAuthStatus(){this.isUnlocked||"/login"===this.$route.path||(console.log("用户未解锁，重定向到登录页"),this.$router.push("/login"))}}},c=i,l=(r("91f1"),r("2877")),d=Object(l["a"])(c,a,s,!1,null,null,null),u=d.exports,p=r("8c4f");n["a"].use(p["a"]);const f=[{path:"/",redirect:"/login"},{path:"/operation",name:"Operation",component:()=>r.e("chunk-4cd54a56").then(r.bind(null,"86bd"))},{path:"/wallet",name:"Wallet",component:()=>r.e("chunk-a8eeebe8").then(r.bind(null,"4dd7"))},{path:"/login",name:"Login",component:()=>r.e("chunk-3f53d80d").then(r.bind(null,"a55b3"))}],m=new p["a"]({routes:f});m.beforeEach((e,t,r)=>{const n=localStorage.getItem("encryptedData"),a=sessionStorage.getItem("isUnlocked");if("/login"===e.path)return void r();if(n&&!a)return void r("/login");if(!n&&"/login"!==e.path)return void r("/login");const s=m.app.$store&&m.app.$store.state.isUnlocked;s||"/login"===e.path?r():r("/login")});var h=m,A=r("d01b"),g=r.n(A),T=r("bc3a"),w=r.n(T),I=r("3452"),E=r.n(I);function S(e,t){try{const r=JSON.stringify(e),n=E.a.AES.encrypt(r,t).toString();return n}catch(r){throw console.error("加密失败",r),r}}function _(e,t){try{const r=E.a.AES.decrypt(e,t).toString(E.a.enc.Utf8);if(!r)throw new Error("解密失败：密码错误");return JSON.parse(r)}catch(r){throw console.error("解密失败",r),r}}var y=r("f121");n["a"].use(o["a"]);const P=w.a.create({timeout:y["a"].TIMEOUT}),b=async(e,t={},r=!1)=>{try{return r&&e.includes(y["a"].TRON_API_BASE)&&(e=e.replace(y["a"].TRON_API_BASE,y["a"].BACKUP_TRON_API_BASE)),await P.get(e,t)}catch(n){if(!r&&y["a"].BACKUP_TRON_API_BASE)return console.log("主 API 请求失败，尝试使用备用 API"),b(e,t,!0);throw n}};var v=new o["a"].Store({state:{wallets:[],isUnlocked:!1,currentTab:"operation",sortType:"default",operationAddress:y["c"]},mutations:{SET_WALLETS(e,t){e.wallets=t},ADD_WALLET(e,t){e.wallets.push(t)},SET_UNLOCKED(e,t){console.log("设置解锁状态:",t),e.isUnlocked=t,t?sessionStorage.setItem("isUnlocked","1"):sessionStorage.removeItem("isUnlocked")},SET_CURRENT_TAB(e,t){e.currentTab=t},SET_SORT_TYPE(e,t){e.sortType=t},UPDATE_BALANCE(e,{address:t,balance:r}){const n=e.wallets.find(e=>e.address===t);n&&(n.balance=r)},UPDATE_TRANSACTIONS(e,{address:t,pledgeInfo:r,participateInfo:n,withdrawInfo:a,lastParticipateTime:s,remainingLimit:o}){const i=e.wallets.find(e=>e.address===t);i&&(i.pledgeInfo=r,i.participateInfo=n,i.withdrawInfo=a,i.lastParticipateTime=s,i.remainingLimit=o)},UPDATE_WALLET_REMARK(e,{address:t,remark:r}){const n=e.wallets.find(e=>e.address===t);n&&(n.remark=r)}},actions:{setPassword({commit:e,state:t},r){console.log("设置密码并加密数据");try{const n=S(t.wallets,r);return localStorage.setItem("encryptedData",n),e("SET_UNLOCKED",!0),!0}catch(n){return console.error("设置密码失败:",n),!1}},unlockWallets({commit:e},{password:t}){console.log("尝试解锁钱包");const r=localStorage.getItem("encryptedData");if(!r)return console.error("没有找到加密数据"),!1;try{const n=_(r,t);return e("SET_WALLETS",n),e("SET_UNLOCKED",!0),console.log("解锁成功"),!0}catch(n){return console.error("解锁失败",n),!1}},createWallet({commit:e,state:t,dispatch:r},{privateKey:n,address:a,bindAddress:s,remark:o}){const i={privateKey:n,address:a,bindAddress:s,balance:0,pledgeInfo:null,participateInfo:null,withdrawInfo:null,lastParticipateTime:null,remark:o||"",isWatchOnly:!1};if(e("ADD_WALLET",i),t.isUnlocked){const e=localStorage.getItem("encryptedData");if(e){const e=prompt("请输入当前密码以更新钱包数据");e&&r("setPassword",e)}}return i},importWallet({commit:e,state:t,dispatch:r},{privateKey:n,bindAddress:a,remark:s}){try{const o=new g.a({fullHost:y["a"].TRON_API_BASE}),i=o.address.fromPrivateKey(n),c={privateKey:n,address:i,bindAddress:a,balance:0,pledgeInfo:null,participateInfo:null,withdrawInfo:null,lastParticipateTime:null,remark:s||"",isWatchOnly:!1},l=t.wallets.some(e=>e.address===i);if(l)return{success:!1,message:"钱包已存在"};if(e("ADD_WALLET",c),t.isUnlocked){const e=localStorage.getItem("encryptedData");if(e){const e=prompt("请输入当前密码以更新钱包数据");e&&r("setPassword",e)}}return{success:!0,wallet:c}}catch(o){return console.error("导入钱包失败",o),{success:!1,message:"无效的私钥"}}},importWatchWallet({commit:e,state:t,dispatch:r},{address:n,remark:a}){try{const s=new g.a({fullHost:y["a"].TRON_API_BASE});if(!s.isAddress(n))return{success:!1,message:"无效的钱包地址"};const o={privateKey:"",address:n,bindAddress:"",balance:0,pledgeInfo:null,participateInfo:null,withdrawInfo:null,lastParticipateTime:null,remark:a||"",isWatchOnly:!0},i=t.wallets.some(e=>e.address===n);if(i)return{success:!1,message:"钱包已存在"};if(e("ADD_WALLET",o),t.isUnlocked){const e=localStorage.getItem("encryptedData");if(e){const e=prompt("请输入当前密码以更新钱包数据");e&&r("setPassword",e)}}return{success:!0,wallet:o}}catch(s){return console.error("导入观察钱包失败",s),{success:!1,message:"导入观察钱包失败"}}},async getWalletBalance({commit:e},{address:t}){try{let n,a=new g.a({fullHost:y["a"].TRON_API_BASE});try{n=await a.trx.getBalance(t)}catch(r){console.log("使用主 API 获取余额失败，尝试备用 API"),a=new g.a({fullHost:y["a"].BACKUP_TRON_API_BASE}),n=await a.trx.getBalance(t)}const s=n/1e6;return e("UPDATE_BALANCE",{address:t,balance:s}),s}catch(n){return console.error("获取余额失败",n),0}},async getTransactions({commit:e,state:t},{address:r}){try{const a=new g.a({fullHost:y["a"].TRON_API_BASE}),s=async(e,t)=>{let r=[],n=!0,a=0;while(n){const s=`${y["a"].TRANSFERS_API}?from=${e}&to=${t}&limit=${y["a"].TRANSFERS_LIMIT}&sort=timeStamp&block=${a}`,o=await b(s),i=o.data.data||[];if(r=[...r,...i],i.length>=y["a"].TRANSFERS_LIMIT){const e=i.reduce((e,t)=>t.blockNumber>e.blockNumber?t:e,{blockNumber:0});a=e.blockNumber,console.log(`获取到 ${i.length} 条交易记录，继续查询下一批 (Block > ${a})`)}else n=!1,console.log(`获取到 ${i.length} 条交易记录，查询完成`)}return r};console.log("开始获取出账交易记录...");const o=await s(r,t.operationAddress);console.log("开始获取入账交易记录...");const i=await s(t.operationAddress,r);console.log(`总共获取到 ${o.length} 条出账记录和 ${i.length} 条入账记录`);const c=[...o,...i].sort((e,t)=>e.timeStamp-t.timeStamp);let l=null,d=[],u=[],p=null,f=0;console.log("分析交易记录，总数:",c.length);let m=[];for(const e of c){const s=parseFloat(e.assetAmount)/1e6;if(e.fromAddress===r&&e.toAddress===t.operationAddress)s.toFixed(1)===y["e"].PLEDGE.toFixed(1)?l={txId:e.txId,amount:s,time:e.timeStamp}:s===y["e"].PARTICIPATE?(d.push({txId:e.txId,amount:s,time:e.timeStamp,matched:!1}),p=e.timeStamp):s===y["e"].WITHDRAW_REQUEST&&u.push({txId:e.txId,requestAmount:s,time:e.timeStamp,type:"request"});else if(e.fromAddress===t.operationAddress&&e.toAddress===r)if(s>=1&&s<2&&e.data)try{const t=a.toUtf8(e.data);if(t){const e=t.split("\n");let r="",n="";f=0,e.length>=3&&(r=e[0].split(":")[1].trim()||"",n=e[1].split(":")[1].trim()||"",f=parseInt(e[2].split(":")[1].trim()||"0"),l&&(l.identity=r,l.inviteCode=n,l.remainingLimit=f))}}catch(n){console.error("处理返回信息失败",n)}else s>=y["e"].PARTICIPATE&&m.push({txId:e.txId,receiveAmount:s,time:e.timeStamp,type:"receive"})}u=[...u,...m],u.sort((e,t)=>e.time-t.time);const h=[],A=[],T=m.slice().sort((e,t)=>e.time-t.time);for(const e of d){const t=T.find(t=>t.time>e.time);if(t){const r=T.indexOf(t);T.splice(r,1),h.push({...e,withdraw:t,profit:t.receiveAmount-y["e"].PARTICIPATE}),e.matched=!0}else A.push(e)}const w=A.length>0?A[A.length-1]:null;return e("UPDATE_TRANSACTIONS",{address:r,pledgeInfo:l,participateInfo:w,withdrawInfo:h,lastParticipateTime:p,remainingLimit:f}),{pledgeInfo:l,participateInfo:w,withdrawInfo:h,lastParticipateTime:p,remainingLimit:f}}catch(n){return console.error("获取交易记录失败",n),{pledgeInfo:null,participateInfo:null,withdrawInfo:null,lastParticipateTime:null,remainingLimit:0}}},async transfer({state:e},{fromAddress:t,toAddress:r,amount:n}){try{const o=e.wallets.find(e=>e.address===t);if(!o)throw new Error("钱包不存在");if(o.balance<n)throw new Error("余额不足，需要 "+n+" TRX，当前余额 "+o.balance+" TRX");let i,c,l,d=!1;try{i=new g.a({fullHost:y["a"].TRON_API_BASE,privateKey:o.privateKey});const e=parseInt(i.toSun(n)),a=await i.transactionBuilder.sendTrx(r,e,t),s=await i.trx.sign(a,o.privateKey);c=await i.trx.sendRawTransaction(s),d=!0}catch(a){if(l=a,y["a"].BACKUP_TRON_API_BASE)try{i=new g.a({fullHost:y["a"].BACKUP_TRON_API_BASE,privateKey:o.privateKey});const e=parseInt(i.toSun(n)),a=await i.transactionBuilder.sendTrx(r,e,t),s=await i.trx.sign(a,o.privateKey);c=await i.trx.sendRawTransaction(s),d=!0}catch(s){l=s}}if(d)return{success:!0,txId:c.txid||c.transaction.txID};throw l}catch(a){return{success:!1,message:a.message||"转账失败"}}},async pledge({dispatch:e,state:t},{address:r}){try{return await e("transfer",{fromAddress:r,toAddress:t.operationAddress,amount:y["e"].PLEDGE})}catch(n){return{success:!1,message:n.message||"质押失败"}}},async participate({dispatch:e,state:t},{address:r}){try{return await e("transfer",{fromAddress:r,toAddress:t.operationAddress,amount:y["e"].PARTICIPATE})}catch(n){return{success:!1,message:n.message||"参与失败"}}},async withdraw({dispatch:e,state:t},{address:r}){try{return await e("transfer",{fromAddress:r,toAddress:t.operationAddress,amount:y["e"].WITHDRAW_REQUEST})}catch(n){return{success:!1,message:n.message||"提现失败"}}},async updateAllWallets({state:e,dispatch:t}){const r=e.wallets.map(async e=>{await t("getWalletBalance",{address:e.address}),await t("getTransactions",{address:e.address})});await Promise.all(r)},updateWalletRemark({commit:e,state:t,dispatch:r},{address:n,remark:a}){const s=t.wallets.find(e=>e.address===n);if(s){if(s.remark=a,t.isUnlocked){const e=localStorage.getItem("encryptedData");if(e){const e=prompt("请输入当前密码以更新钱包数据");e&&r("setPassword",e)}}return{success:!0}}return{success:!1,message:"钱包不存在"}}},getters:{sortedWalletsForOperation:e=>{const t=[...e.wallets];return"time"===e.sortType?t.sort((e,t)=>{const r=e.participateInfo?e.participateInfo.time+y["d"].PARTICIPATE_CYCLE:0,n=t.participateInfo?t.participateInfo.time+y["d"].PARTICIPATE_CYCLE:0;return r||n?r?n?r-n:-1:1:0}):t}}});r("6861");n["a"].config.productionTip=!1;const k=h.push;h.push=function(e){return k.call(this,e).catch(e=>"NavigationDuplicated"!==e.name?Promise.reject(e):Promise.resolve())};try{v.commit("SET_UNLOCKED",!1),console.log("页面加载，重置解锁状态")}catch(R){console.error("恢复状态失败:",R),v.commit("SET_UNLOCKED",!1)}n["a"].config.errorHandler=function(e,t,r){console.error("全局错误捕获:"),console.error("错误: "+e.toString()),console.error("信息: "+r),console.error("详细堆栈:",e.stack)},window.addEventListener("unhandledrejection",(function(e){console.error("未处理的Promise拒绝:",e.reason)})),new n["a"]({router:h,store:v,render:e=>e(u)}).$mount("#app")},6:function(e,t){},6861:function(e,t,r){},7:function(e,t){},8:function(e,t){},9:function(e,t){},"91f1":function(e,t,r){"use strict";r("b225")},b225:function(e,t,r){},f121:function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"e",(function(){return a})),r.d(t,"a",(function(){return s})),r.d(t,"d",(function(){return o})),r.d(t,"b",(function(){return i}));const n="TGQ39wzc8cLhJkaAoVnHzbQ6SstLQ53YLx",a={PLEDGE:8.1,PARTICIPATE:12,WITHDRAW_REQUEST:6},s={TRON_API_BASE:"https://api.trongrid.io",TRANSFERS_API:"http://31.220.93.187:18181/api/transfers",TRANSFERS_LIMIT:200,TIMEOUT:1e4,BACKUP_TRON_API_BASE:"https://api.tronstack.io"},o={PARTICIPATE_CYCLE:864e5,REFRESH_DELAY:2e3},i={MIN_PLEDGE:8.1,MIN_PARTICIPATE:12,MIN_WITHDRAW:6}}});