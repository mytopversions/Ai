(function(e){function t(t){for(var s,a,c=t[0],i=t[1],l=t[2],d=0,u=[];d<c.length;d++)a=c[d],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&u.push(n[a][0]),n[a]=0;for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s]);p&&p(t);while(u.length)u.shift()();return o.push.apply(o,l||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],s=!0,a=1;a<r.length;a++){var c=r[a];0!==n[c]&&(s=!1)}s&&(o.splice(t--,1),e=i(i.s=r[0]))}return e}var s={},a={app:0},n={app:0},o=[];function c(e){return i.p+"js/"+({}[e]||e)+"."+{"chunk-18364282":"c12d596e","chunk-205f141b":"4c74baae","chunk-8e419ca2":"f80b0a86"}[e]+".js"}function i(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],r={"chunk-18364282":1,"chunk-205f141b":1,"chunk-8e419ca2":1};a[e]?t.push(a[e]):0!==a[e]&&r[e]&&t.push(a[e]=new Promise((function(t,r){for(var s="css/"+({}[e]||e)+"."+{"chunk-18364282":"ff3d4888","chunk-205f141b":"c43e68cb","chunk-8e419ca2":"e2568d17"}[e]+".css",n=i.p+s,o=document.getElementsByTagName("link"),c=0;c<o.length;c++){var l=o[c],d=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(d===s||d===n))return t()}var u=document.getElementsByTagName("style");for(c=0;c<u.length;c++){l=u[c],d=l.getAttribute("data-href");if(d===s||d===n)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var s=t&&t.target&&t.target.src||n,o=new Error("Loading CSS chunk "+e+" failed.\n("+s+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=s,delete a[e],p.parentNode.removeChild(p),r(o)},p.href=n;var m=document.getElementsByTagName("head")[0];m.appendChild(p)})).then((function(){a[e]=0})));var s=n[e];if(0!==s)if(s)t.push(s[2]);else{var o=new Promise((function(t,r){s=n[e]=[t,r]}));t.push(s[2]=o);var l,d=document.createElement("script");d.charset="utf-8",d.timeout=120,i.nc&&d.setAttribute("nonce",i.nc),d.src=c(e);var u=new Error;l=function(t){d.onerror=d.onload=null,clearTimeout(p);var r=n[e];if(0!==r){if(r){var s=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+s+": "+a+")",u.name="ChunkLoadError",u.type=s,u.request=a,r[1](u)}n[e]=void 0}};var p=setTimeout((function(){l({type:"timeout",target:d})}),12e4);d.onerror=d.onload=l,document.head.appendChild(d)}return Promise.all(t)},i.m=e,i.c=s,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],d=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var p=d;o.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},1:function(e,t){},10:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,r){"use strict";r.r(t);var s=r("a026"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[e.showTabs?r("div",{staticClass:"tab-bar"},[r("div",{staticClass:"tab-item",class:{active:"operation"===e.currentTab},on:{click:function(t){return e.switchTab("operation")}}},[e._v(" 操作 ")]),r("div",{staticClass:"tab-item",class:{active:"wallet"===e.currentTab},on:{click:function(t){return e.switchTab("wallet")}}},[e._v(" 钱包 ")])]):e._e(),r("router-view")],1)},n=[],o=r("2f62"),c={name:"App",computed:{...Object(o["e"])(["currentTab","isUnlocked"]),showTabs(){const e="/login"===this.$route.path;return console.log("Route:",this.$route.path,"isUnlocked:",this.isUnlocked,"Show tabs:",this.isUnlocked&&!e),this.isUnlocked&&!e}},created(){this.checkAuthStatus()},watch:{$route(e,t){this.checkAuthStatus()},isUnlocked(e,t){e||"/login"===this.$route.path||this.$router.push("/login")}},methods:{...Object(o["d"])(["SET_CURRENT_TAB"]),switchTab(e){console.log("切换到标签页:",e),this.SET_CURRENT_TAB(e);const t="/"+e;this.$route.path!==t&&this.$router.push(t).catch(e=>{"NavigationDuplicated"!==e.name&&console.error("导航错误:",e)})},checkAuthStatus(){this.isUnlocked||"/login"===this.$route.path||(console.log("用户未解锁，重定向到登录页"),this.$router.push("/login"))}}},i=c,l=(r("91f1"),r("2877")),d=Object(l["a"])(i,a,n,!1,null,null,null),u=d.exports,p=r("8c4f");s["a"].use(p["a"]);const m=[{path:"/",redirect:"/login"},{path:"/operation",name:"Operation",component:()=>r.e("chunk-205f141b").then(r.bind(null,"86bd"))},{path:"/wallet",name:"Wallet",component:()=>r.e("chunk-18364282").then(r.bind(null,"4dd7"))},{path:"/login",name:"Login",component:()=>r.e("chunk-8e419ca2").then(r.bind(null,"a55b3"))}],f=new p["a"]({routes:m});f.beforeEach((e,t,r)=>{const s=localStorage.getItem("encryptedData"),a=sessionStorage.getItem("isUnlocked");if("/login"===e.path)return void r();if(s&&!a)return void r("/login");if(!s&&"/login"!==e.path)return void r("/login");const n=f.app.$store&&f.app.$store.state.isUnlocked;n||"/login"===e.path?r():r("/login")});var h=f,A=r("d01b"),T=r.n(A),g=r("bc3a"),w=r.n(g),E=r("90c5"),P=r("f121");s["a"].use(o["a"]);const I=w.a.create({timeout:P["a"].TIMEOUT}),_=async(e,t={},r=!1)=>{try{return r&&e.includes(P["a"].TRON_API_BASE)&&(e=e.replace(P["a"].TRON_API_BASE,P["a"].BACKUP_TRON_API_BASE)),await I.get(e,t)}catch(s){if(!r&&P["a"].BACKUP_TRON_API_BASE)return console.log("主 API 请求失败，尝试使用备用 API"),_(e,t,!0);throw s}};var S=new o["a"].Store({state:{wallets:[],isUnlocked:!1,currentTab:"operation",sortType:"default",operationAddress:P["c"],currentPassword:""},mutations:{SET_WALLETS(e,t){e.wallets=t},ADD_WALLET(e,t){e.wallets.push(t)},SET_UNLOCKED(e,t){console.log("设置解锁状态:",t),e.isUnlocked=t,t?sessionStorage.setItem("isUnlocked","1"):(sessionStorage.removeItem("isUnlocked"),e.currentPassword="")},SET_CURRENT_TAB(e,t){e.currentTab=t},SET_SORT_TYPE(e,t){e.sortType=t},SET_CURRENT_PASSWORD(e,t){e.currentPassword=t},UPDATE_BALANCE(e,{address:t,balance:r}){const s=e.wallets.find(e=>e.address===t);s&&(s.balance=r)},UPDATE_TRANSACTIONS(e,{address:t,pledgeInfo:r,participateInfo:s,withdrawInfo:a,lastParticipateTime:n,remainingLimit:o}){const c=e.wallets.find(e=>e.address===t);c&&(c.pledgeInfo=r,c.participateInfo=s,c.withdrawInfo=a,c.lastParticipateTime=n,c.remainingLimit=o)},UPDATE_WALLET_REMARK(e,{address:t,remark:r}){const s=e.wallets.find(e=>e.address===t);s&&(s.remark=r)},UPDATE_WALLET_BIND_ADDRESS(e,{address:t,bindAddress:r}){const s=e.wallets.find(e=>e.address===t);s&&(s.bindAddress=r)},REMOVE_WALLET(e,{address:t}){e.wallets=e.wallets.filter(e=>e.address!==t)}},actions:{setPassword({commit:e,state:t},r){console.log("设置密码并加密数据");try{const s=Object(E["encryptData"])(t.wallets,r);return localStorage.setItem("encryptedData",s),e("SET_UNLOCKED",!0),e("SET_CURRENT_PASSWORD",r),!0}catch(s){return console.error("设置密码失败:",s),!1}},unlockWallets({commit:e},{password:t}){console.log("尝试解锁钱包");const r=localStorage.getItem("encryptedData");if(!r)return console.error("没有找到加密数据"),!1;try{const s=Object(E["decryptData"])(r,t);return e("SET_WALLETS",s),e("SET_UNLOCKED",!0),e("SET_CURRENT_PASSWORD",t),console.log("解锁成功"),!0}catch(s){return console.error("解锁失败",s),!1}},createWallet({commit:e,state:t,dispatch:r},{privateKey:s,address:a,bindAddress:n,remark:o}){const c={privateKey:s,address:a,bindAddress:n,balance:0,pledgeInfo:null,participateInfo:null,withdrawInfo:null,lastParticipateTime:null,remark:o||"",isWatchOnly:!1};return e("ADD_WALLET",c),t.isUnlocked&&t.currentPassword&&r("setPassword",t.currentPassword),c},importWallet({commit:e,state:t,dispatch:r},{privateKey:s,bindAddress:a,remark:n}){try{const o=new T.a({fullHost:P["a"].TRON_API_BASE}),c=o.address.fromPrivateKey(s),i={privateKey:s,address:c,bindAddress:a,balance:0,pledgeInfo:null,participateInfo:null,withdrawInfo:null,lastParticipateTime:null,remark:n||"",isWatchOnly:!1},l=t.wallets.some(e=>e.address===c);return l?{success:!1,message:"钱包已存在"}:(e("ADD_WALLET",i),t.isUnlocked&&t.currentPassword&&r("setPassword",t.currentPassword),{success:!0,wallet:i})}catch(o){return console.error("导入钱包失败",o),{success:!1,message:"无效的私钥"}}},importWatchWallet({commit:e,state:t,dispatch:r},{address:s,remark:a}){try{const n=new T.a({fullHost:P["a"].TRON_API_BASE});if(!n.isAddress(s))return{success:!1,message:"无效的钱包地址"};const o={privateKey:"",address:s,bindAddress:"",balance:0,pledgeInfo:null,participateInfo:null,withdrawInfo:null,lastParticipateTime:null,remark:a||"",isWatchOnly:!0},c=t.wallets.some(e=>e.address===s);return c?{success:!1,message:"钱包已存在"}:(e("ADD_WALLET",o),t.isUnlocked&&t.currentPassword&&r("setPassword",t.currentPassword),{success:!0,wallet:o})}catch(n){return console.error("导入观察钱包失败",n),{success:!1,message:"导入观察钱包失败"}}},async getWalletBalance({commit:e},{address:t}){try{const s=P["a"].TRON_API_BASE,a=P["a"].BACKUP_TRON_API_BASE;let n=t,o=0,c=!1;try{console.log("使用主API获取余额:",s);const e={method:"POST",url:s+"/wallet/getaccount",headers:{accept:"application/json","content-type":"application/json"},data:{address:n,visible:!0},timeout:P["a"].TIMEOUT},t=await w()(e);t.data&&void 0!==t.data.balance?(o=t.data.balance,c=!0):console.log("主API未返回余额数据")}catch(r){console.error("使用主API获取余额失败:",r.message)}if(!c&&a)try{console.log("使用备用API获取余额:",a);const e={method:"POST",url:a+"/wallet/getaccount",headers:{accept:"application/json","content-type":"application/json"},data:{address:n,visible:!0},timeout:P["a"].TIMEOUT},t=await w()(e);t.data&&void 0!==t.data.balance?(o=t.data.balance,c=!0):console.log("备用API未返回余额数据")}catch(r){console.error("使用备用API获取余额失败:",r.message)}if(!c){console.log("API请求失败，尝试使用TronWeb获取余额");try{const e=new T.a({fullHost:s||a});o=await e.trx.getBalance(t)}catch(r){console.error("使用TronWeb获取余额也失败:",r.message),o=0}}const i=o/1e6;return e("UPDATE_BALANCE",{address:t,balance:i}),i}catch(s){return console.error("获取余额失败",s),0}},async getTransactions({commit:e,state:t},{address:r}){try{const a=new T.a({fullHost:P["a"].TRON_API_BASE}),n=async(e,t)=>{let r=[],s=!0,a=0;while(s){const n=`${P["a"].TRANSFERS_API}?from=${e}&to=${t}&limit=${P["a"].TRANSFERS_LIMIT}&sort=timeStamp&block=${a}`,o=await _(n),c=o.data.data||[];if(r=[...r,...c],c.length>=P["a"].TRANSFERS_LIMIT){const e=c.reduce((e,t)=>t.blockNumber>e.blockNumber?t:e,{blockNumber:0});a=e.blockNumber,console.log(`获取到 ${c.length} 条交易记录，继续查询下一批 (Block > ${a})`)}else s=!1,console.log(`获取到 ${c.length} 条交易记录，查询完成`)}return r};console.log("开始获取出账交易记录...");const o=await n(r,t.operationAddress);console.log("开始获取入账交易记录...");const c=await n(t.operationAddress,r);console.log(`总共获取到 ${o.length} 条出账记录和 ${c.length} 条入账记录`);const i=[...o,...c].sort((e,t)=>e.timeStamp-t.timeStamp);let l=null,d=[],u=[],p=null,m=0;console.log("分析交易记录，总数:",i.length);let f=[];for(const e of i){const n=parseFloat(e.assetAmount)/1e6;if(e.fromAddress===r&&e.toAddress===t.operationAddress)n.toFixed(1)===P["e"].PLEDGE.toFixed(1)?l={txId:e.txId,amount:n,time:e.timeStamp}:n===P["e"].PARTICIPATE?(d.push({txId:e.txId,amount:n,time:e.timeStamp,matched:!1}),p=e.timeStamp):n===P["e"].WITHDRAW_REQUEST&&u.push({txId:e.txId,requestAmount:n,time:e.timeStamp,type:"request"});else if(e.fromAddress===t.operationAddress&&e.toAddress===r)if(n>=1&&n<2&&e.data)try{const t=a.toUtf8(e.data);if(t){const e=t.split("\n");let r="",s="";m=0,e.length>=3&&(r=e[0].split(":")[1].trim()||"",s=e[1].split(":")[1].trim()||"",m=parseInt(e[2].split(":")[1].trim()||"0"),l&&(l.identity=r,l.inviteCode=s,l.remainingLimit=m))}}catch(s){console.error("处理返回信息失败",s)}else n>=P["e"].PARTICIPATE&&(m-=n-P["e"].PARTICIPATE,f.push({txId:e.txId,receiveAmount:n,time:e.timeStamp,type:"receive"}))}u=[...u,...f],u.sort((e,t)=>e.time-t.time);const h=[],A=[],g=f.slice().sort((e,t)=>e.time-t.time);for(const e of d){const t=g.find(t=>t.time>e.time);if(t){const r=g.indexOf(t);g.splice(r,1),h.push({...e,withdraw:t,profit:t.receiveAmount-P["e"].PARTICIPATE}),e.matched=!0}else A.push(e)}const w=A.length>0?A[A.length-1]:null;return e("UPDATE_TRANSACTIONS",{address:r,pledgeInfo:l,participateInfo:w,withdrawInfo:h,lastParticipateTime:p,remainingLimit:m}),{pledgeInfo:l,participateInfo:w,withdrawInfo:h,lastParticipateTime:p,remainingLimit:m}}catch(s){return console.error("获取交易记录失败",s),{pledgeInfo:null,participateInfo:null,withdrawInfo:null,lastParticipateTime:null,remainingLimit:0}}},async transfer({state:e},{fromAddress:t,toAddress:r,amount:s}){try{const o=e.wallets.find(e=>e.address===t);if(!o)throw new Error("钱包不存在");if(o.balance<s)throw new Error("余额不足，需要 "+s+" TRX，当前余额 "+o.balance+" TRX");let c,i,l,d=!1;try{c=new T.a({fullHost:P["a"].TRON_API_BASE,privateKey:o.privateKey});const e=parseInt(c.toSun(s)),a=await c.transactionBuilder.sendTrx(r,e,t),n=await c.trx.sign(a,o.privateKey);i=await c.trx.sendRawTransaction(n),d=!0}catch(a){if(l=a,P["a"].BACKUP_TRON_API_BASE)try{c=new T.a({fullHost:P["a"].BACKUP_TRON_API_BASE,privateKey:o.privateKey});const e=parseInt(c.toSun(s)),a=await c.transactionBuilder.sendTrx(r,e,t),n=await c.trx.sign(a,o.privateKey);i=await c.trx.sendRawTransaction(n),d=!0}catch(n){l=n}}if(d)return{success:!0,txId:i.txid||i.transaction.txID};throw l}catch(a){return{success:!1,message:a.message||"转账失败"}}},async pledge({dispatch:e,state:t},{address:r}){try{return await e("transfer",{fromAddress:r,toAddress:t.operationAddress,amount:P["e"].PLEDGE})}catch(s){return{success:!1,message:s.message||"质押失败"}}},async participate({dispatch:e,state:t},{address:r}){try{return await e("transfer",{fromAddress:r,toAddress:t.operationAddress,amount:P["e"].PARTICIPATE})}catch(s){return{success:!1,message:s.message||"参与失败"}}},async withdraw({dispatch:e,state:t},{address:r}){try{return await e("transfer",{fromAddress:r,toAddress:t.operationAddress,amount:P["e"].WITHDRAW_REQUEST})}catch(s){return{success:!1,message:s.message||"提现失败"}}},async updateAllWallets({state:e,dispatch:t}){const r=e.wallets.map(async e=>{await t("getWalletBalance",{address:e.address}),await t("getTransactions",{address:e.address})});await Promise.all(r)},async updateSingleWallet({state:e,dispatch:t},{address:r}){const s=e.wallets.find(e=>e.address===r);return!!s&&(await t("getWalletBalance",{address:r}),await t("getTransactions",{address:r}),!0)},updateWalletRemark({commit:e,state:t,dispatch:r},{address:s,remark:a}){const n=t.wallets.find(e=>e.address===s);return n?(n.remark=a,e("UPDATE_WALLET_REMARK",{address:s,remark:a}),t.isUnlocked&&t.currentPassword&&r("setPassword",t.currentPassword),{success:!0}):{success:!1,message:"钱包不存在"}},updateBindAddress({commit:e,state:t,dispatch:r},{address:s,bindAddress:a}){const n=t.wallets.find(e=>e.address===s);return n?n.isWatchOnly?{success:!1,message:"观察钱包无法修改绑定地址"}:(e("UPDATE_WALLET_BIND_ADDRESS",{address:s,bindAddress:a}),t.isUnlocked&&t.currentPassword&&r("setPassword",t.currentPassword),{success:!0}):{success:!1,message:"钱包不存在"}},deleteWallet({commit:e,state:t,dispatch:r},{address:s}){const a=t.wallets.find(e=>e.address===s);return a?(e("REMOVE_WALLET",{address:s}),t.isUnlocked&&t.currentPassword&&r("setPassword",t.currentPassword),{success:!0}):{success:!1,message:"钱包不存在"}}},getters:{sortedWalletsForOperation:e=>{const t=[...e.wallets];return"time"===e.sortType?t.sort((e,t)=>{const r=e.participateInfo?e.participateInfo.time+P["d"].PARTICIPATE_CYCLE:0,s=t.participateInfo?t.participateInfo.time+P["d"].PARTICIPATE_CYCLE:0;return r||s?r?s?r-s:-1:1:0}):t}}});r("6861");s["a"].config.productionTip=!1;const b=h.push;h.push=function(e){return b.call(this,e).catch(e=>"NavigationDuplicated"!==e.name?Promise.reject(e):Promise.resolve())};try{S.commit("SET_UNLOCKED",!1),console.log("页面加载，重置解锁状态")}catch(y){console.error("恢复状态失败:",y),S.commit("SET_UNLOCKED",!1)}s["a"].config.errorHandler=function(e,t,r){console.error("全局错误捕获:"),console.error("错误: "+e.toString()),console.error("信息: "+r),console.error("详细堆栈:",e.stack)},window.addEventListener("unhandledrejection",(function(e){console.error("未处理的Promise拒绝:",e.reason)})),new s["a"]({router:h,store:S,render:e=>e(u)}).$mount("#app")},6:function(e,t){},6861:function(e,t,r){},7:function(e,t){},8:function(e,t){},9:function(e,t){},"90c5":function(e,t,r){"use strict";r.r(t),r.d(t,"encryptData",(function(){return n})),r.d(t,"decryptData",(function(){return o}));var s=r("3452"),a=r.n(s);function n(e,t){try{const r=JSON.stringify(e),s=a.a.AES.encrypt(r,t).toString();return s}catch(r){throw console.error("加密失败",r),r}}function o(e,t){try{const r=a.a.AES.decrypt(e,t).toString(a.a.enc.Utf8);if(!r)throw new Error("解密失败：密码错误");return JSON.parse(r)}catch(r){throw console.error("解密失败",r),r}}},"91f1":function(e,t,r){"use strict";r("b225")},b225:function(e,t,r){},f121:function(e,t,r){"use strict";r.d(t,"c",(function(){return s})),r.d(t,"e",(function(){return a})),r.d(t,"a",(function(){return n})),r.d(t,"d",(function(){return o})),r.d(t,"b",(function(){return c}));const s="TRXcWWV5MBtVGs4E4s3VnaPervSmAiAiAi",a={PLEDGE:2000.1,PARTICIPATE:3e3,WITHDRAW_REQUEST:20},n={TRON_API_BASE:"https://api.trongrid.io",TRANSFERS_API:"//31.220.93.187:18181/api/transfers",TRANSFERS_LIMIT:200,TIMEOUT:1e4,BACKUP_TRON_API_BASE:"https://api.tronstack.io"},o={PARTICIPATE_CYCLE:864e5,REFRESH_DELAY:2e3},c={MIN_PLEDGE:2000.1,MIN_PARTICIPATE:3e3,MIN_WITHDRAW:20}}});